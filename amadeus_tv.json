{
    "app-id": "org.flatpak.amadeustv",
    "runtime": "org.gnome.Platform",
    "runtime-version": "42",
    "sdk": "org.gnome.Sdk",
    "command": "run.sh",
    "finish-args": [
        "--share=network",
        "--socket=x11",
        "--socket=wayland",
        "--socket=pulseaudio",
        "--socket=system-bus",
        "--share=ipc",
        "--device=dri",
        "--talk-name=org.gtk.vfs",
        "--talk-name=org.gtk.vfs.*", 
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.freedesktop.secrets",
        "--talk-name=org.freedesktop.Flatpak",
        "--talk-name=org.gnome.OnlineAccounts",
        "--env=GST_PLUGIN_PATH=/app/lib/codecs/lib/gstreamer-1.0"
    ],
    "add-extensions": {
        "org.gnome.Totem.Codecs": {
            "directory": "lib/codecs",
            "add-ld-path": "lib",
            "bundle" : true,
            "autodelete" : true
        },
        "org.gnome.Totem.Videosite": {
            "directory": "lib/totem-pl-parser",
            "merge-dirs": "lib;bin;site-packages",
            "add-ld-path": "lib",
            "subdirectories": true,
            "autodelete" : true
        }
    },
    "cleanup": [ "/include", "/share/bash-completion", "/share/doc", "/lib/*.la" ],
    "modules": [
        "codecs/liba52.json",
        "codecs/libmpeg2.json",
        "codecs/libdvdcss.json",
        "codecs/libdvdread.json",
        "codecs/libdvdnav.json",
        "codecs/libass.json",
        "codecs/ffmpeg.json",
        "codecs/gstreamer.json",
        "codecs/pipewire.json",
        {
            "name": "libpeas",
            "buildsystem": "meson",
            "sources": [
                {
                    "type": "git",
                    "url": "https://gitlab.gnome.org/GNOME/libpeas.git",
                    "commit": "6b4217e0a5ec451cdbe9380df26d701d8e6bdf88",
                    "tag": "libpeas-1.26.0"
                }
            ]
        },
        {
            "name": "runner",
            "buildsystem": "simple",
            "build-commands": [
                "install -D run.sh /app/bin/run.sh",
                "cp -r resources/ /app/resources",
                "cp -r qml/ /app/qml",
                "cp -r assets/ /app/assets",
                "install -D main.py /app/main.py"
            ],
            "sources": [
                {
                    "type": "file",
                    "path": "src/main.py"
                },
                {
                    "type": "file",
                    "path": "run.sh"
                }, 
                {
                    "type": "dir",
                    "path": "src/resources/",
                    "dest": "resources/"
                },
                {
                    "type": "dir",
                    "path": "src/qml/",
                    "dest": "qml/"
                },
                {
                    "type": "dir",
                    "path": "src/assets/",
                    "dest": "assets/"
                }
            ]
        },
        {
            "name": "gnome-desktop",
            "buildsystem": "meson",
            "config-opts": ["-Ddebug_tools=true", "-Dudev=disabled"],
            "cleanup": [ "/libexec/gnome-desktop-debug" ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://gitlab.gnome.org/GNOME/gnome-desktop.git",
                    "commit": "c3e756b28ddfeda0fa061d51cb11e47e09791770",
                    "tag": "42.0"
                }
            ]
        },
        {
            "name": "cpython",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.python.org/ftp/python/3.10.4/Python-3.10.4.tar.xz",
                    "md5": "21f2e113e087083a1e8cf10553d93599"
                }
            ]
        },
        {
            "name": "gdbm",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ftp.gnu.org/gnu/gdbm/gdbm-1.23.tar.gz",
                    "md5": "8551961e36bf8c70b7500d255d3658ec"
                }
            ]
        },
        {
            "name": "pip-install",
            "buildsystem": "simple",
            "build-options": {
              "build-args": [
                "--share=network"
              ]
            },
            "build-commands": [
                "pip3 install Pyside2~=5.15",
                "pip3 install requests~=2.26.0",
                "pip3 install m3u8",
                "pip3 install uuid"
            ]
        }
    ],
    "cleanup-commands" : [
        "mv /app/lib/libdvd*.*so* /app/lib/liba52*.*so* /app/lib/codecs/lib/",
        "mv /app/lib/libass.*so* /app/lib/codecs/lib/",
        "mkdir -p /app/lib/ffmpeg"
    ]
}